\begin{section}{Analyse du cryptosystème: sécurité, profondeur des circuits}
	\begin{subsection}{Sécurité du cryptosystème}

	\begin{definition}{Distance statistique}
	Soit $X$ et $Y$ deux variables aléatoires supportée par
	un ensemble $\mathcal{V}$ et à valeur 
	dans un groupe abélien $G$. On définit la distance 
	statistique entre $X$ et $Y$, notée $\SD(X,Y)$, 
	comme étant la somme:
	\[ \frac{1}{2} \sum_{v \in \mathcal{V}} |\mathbb{P}(X = v) -
	\mathbb{P}(Y = v)| \]

	De plus, on dira que deux familles ${\{X_i\}}_{i \in \NN}$, ${\{Y_i\}}_{i \in \NN}$
	de distributions sont statistiquement indistinguables si 
	la fonction 
	\[ i \longrightarrow \SD(X_i, Y_i) \]
	est négligeable.

	% \begin{prop}
	% Pour $X$ et $Y$ définies comme précédemment, on a:
	% \[\SD(X,Y) = \max_{\mathcal{W}\subset\mathcal{V}} | \PP(X\in\mathcal{W}) - \PP(Y\in\mathcal{W})| \]
	% \end{prop}
	% \begin{proof}
	% \end{proof}
	\end{definition}
	\begin{prop} \label{sd_add}
	Soit ${(X_i)}_{1\leq i \leq n}$ et resp .${(Y_i)}_{1\leq i\leq n}$
	deux n-uplets de distributions indépendantes.
	\[ \SD\left((X_1,\cdots,X_n), (Y_1, \cdots, Y_n)\right) \leq \sum_{i=1}^n \SD(X_i,Y_i) \]
	\end{prop}
	\begin{proof}
	Montrons le pour $n = 2$, la suite se déduisant par récurrence.
	On a:
	\begin{align*}
		&\SD\left((X_1,X_2),(Y_1,Y_2)\right) \\
		&= \frac{1}{2} \sum_{(u,v)}\left| \PP(X_1=u)\PP(X_2=v) -
		\PP(Y_1=u)\PP(Y_2=v) \right| \\ 
		&\leq 
		\frac{1}{2} \sum_{(u,v)}\left| \PP(X_1=u)\left(\PP(X_2=v) - \PP(Y_2 = v)\right)
		- (\PP(X_1 = u) - \PP(Y_1=u))\PP(Y_2=v) \right| \\
		&\leq
		\frac{1}{2} \sum_{(u,v)} \PP(X_1 = u)
		\left|\left(\PP(X_2=v) - \PP(Y_2 = v)\right) \right| + 
		\frac{1}{2} \sum_{(u,v)}\PP(Y_2=v)\left|(\PP(X_1 = u) - \PP(Y_1=u)) \right| \\
		&= \SD(X_1, Y_1) + \SD(X_2, Y_2)
	\end{align*}
	\end{proof}
	\begin{prop}
	Si deux familles de distributions sont statistiquement
	indistinguables, elles sont calculatoirement indistinguables.
	\end{prop} 

	Le lemme suivant correspond au Claim 5.2 présent dans~\cite{STOC:Regev05}
	et nous sera utile pour la suite.

	\begin{lemme}
	Soit $G$ un groupe abélien fini. Pour $r > 1$ et 
	$\mathcal{F} \subset (g_1, \ldots, g_r) \in G^r$, on
	note
	 $s_\mathcal{F}$ la distribution aléatoire qui à un aléa
	 fait correspondre la somme $\sum_{i\in X} g_i$ pour un
	 sous-ensemble choisi de façon uniforme  $X\subset \llbracket
	 1, r \rrbracket$. 
	 D'autre part, on considère la distribution uniforme
	 $U$ sur $G$
	 Alors, on a: 
	 \[\mathbb{E}_{\mathcal{F}\subset G^r}(SD(s_\mathcal{F},U)) \leq 
	   \sqrt{\frac{|G|}{2^r}}\]
	 Notamment, 
	 \[\mathbb{P}\left(SD(s_\mathcal{F},U) \geq
		 \sqrt[\leftroot{-3}\uproot{8}4\:]{\frac{|G|}{2^r}} \right) \leq
		 \sqrt[\leftroot{-3}\uproot{8}4\:]{\frac{|G|}{2^r}}
	 \]
	\end{lemme}
	\begin{proof}
		Remarquons que:
	\begin{align*}
		\sum_{h\in G} {\PP(s_F = h)}^2 &= 
		\PP\left(\sum_i b_i g_i = \sum_i b'_i g_i\right) \\
		& \leq \frac{1}{2^l} + \PP
		\left( \sum_i b_i g_i = \sum_i b'_i g_i |\:\: (b_i)_i \neq
		(b'_i)_i \right)
	\end{align*}
	Or, pour $(b_i)_i \neq (b'_i)_i$, 
		\[ \PP\left((g_i)_i\: :\: \sum_i b_i g_i = \sum_i b'_i
		g_i\right) = \frac{1}{|G|}\]
	D'où on déduit que:
	\[\mathbb{E}_\mathcal{F}\left(\sum_h {\PP(s_{\mathcal{F}} =
	h)}^2\right) \leq \frac{1}{2^l} + \frac{1}{|G|} \]

	Ce qui implique que:

\begin{align*}
\mathbb{E}_\mathcal{F}\left[ \sum_h\Big| \PP(s_F = h) - 1/|G|\Big| \right] 
&\leq
\mathbb{E}_\mathcal{F}
\left[ 
	{|G|}^{1/2}
	{ \left( \sum_h {\left(\PP(s_F = h) - 1/|G|\right)}^2
	\right)}^{1/2}
\right] 
\\
&= \sqrt{|G|} \:\:
\mathbb{E}_\mathcal{F}
	\left[ 
	{\left( \sum_h {\PP(s_F = h)}^2 - 1/|G|\right)}^{1/2} 
	\right] \\
&\leq \sqrt{|G|} \:\:
{\left( 
	\mathbb{E}_\mathcal{F}\left[ \sum_h  {\PP(s_F = h)}^2  \right]
- \frac{1}{|G|}
\right)}^{1/2} \\
	&\leq \sqrt{\frac{|G|}{2^l}}
\end{align*}

\end{proof}

	\begin{cor}
	Soit $G$ un groupe abélien fini. Pour $r > 1$ et 
	$\mathcal{F} \subset (g_1, \ldots, g_r) \in G^r$, on
	note
	 $s_\mathcal{F}$ la distribution aléatoire qui à un aléa
	 fait correspondre la somme $\sum_{i\in X} g_i$ pour un
	 sous-ensemble choisi de façon uniforme  $X\subset \llbracket
	 1, r \rrbracket$. 
	 Considérons alors le n-uplet $S_\mathcal{F} = (X_1, \ldots, X_r)$ où 
	 les $X_i$ sont indépendants de même loi
	 $s_\mathcal{F}$.
	 D'autre part, on considère la distribution uniforme
	 $U$ sur $G^r$
	 Alors, on a: 
	 \[\mathbb{E}_{\mathcal{F}\subset G^r}(SD(s_\mathcal{F},U)) \leq 
	   \sqrt{r^2\frac{|G|}{2^r}}\]
	 Notamment, 
	 \[\mathbb{P}\left(SD(s_\mathcal{F},U) \geq
		 \sqrt[\leftroot{-3}\uproot{8}4\:]{r^2\frac{|G|}{2^r}} \right) \leq
		 \sqrt[\leftroot{-3}\uproot{8}4\:]{r^2\frac{|G|}{2^r}}
	 \]
	\end{cor}
	\begin{proof}
		Découle directement de la proposition précédente ainsi que de
		la proposition \ref{sd_add}
	\end{proof}

	\begin{prop}
	Supposons avoir pris des paramètres $(n, q, \chi, m)$
	tels que l'hypothèse $\LWE$ soit vraie. Alors pour $\epsilon>0$
	et $m > (1+\epsilon)(n+1)\log(q)$ et $m = \mathcal{O}(n\log(q))$ , la distribution jointe
	$(A, RA)$ est calculatoirement indistinguable de la
	distribution uniforme sur $\ZZq^{m \times (n+1)} \times \ZZq^{N
	\times (n+1)}$
	\end{prop}
	\begin{proof}
	On peut deja voir que comme $A$ est calculatoirement
	indistinguable de $U$, $(A, RA)$ l'est de $(U,RU)$ car on 
	peut facilement créer $(A, RA)$ (resp. $(U, RU)$) à partir de
	$A$ (resp. $U$).

	Il nous faut donc monter que $\mathcal{D}_1 = (U, RU)$ est calculatoirement
	indistinguable de $\mathcal{D}_2 = (U, V)$ où $V$ est uniforme.
	
	On peut alors utiliser le lemme précédent avec $G = \ZZq^{n+1}$
	et $r = m$ afin de voir qu'il echiste une constante $\lambda > 0$
	telle que:
	\[\mathbb{E}_{\mathcal{U}\subset \ZZq^{m\times n+1}}(SD(RU,V)) \leq 
		\sqrt{m^2\frac{q^{n+1}}{2^m}}\leq \lambda
	n\log(q)\sqrt{\frac{1}{q^{\epsilon(n+1)}}}=: f(n) \]
	Et, notant $Y = \{ U: \SD(RU,V) \geq \sqrt{f(n)}\}$, on obtient:
	\[\PP(U \in Y) \leq \sqrt{f(n)} \]
	où $f$ est négligeable en $n$. 



	
	Soit $(x,y)\in \ZZq^{m \times (n+1)} \times \ZZq^{m \times (n+1)}$
	\begin{align*}
	&\left|\PP(D_1 = (x,y)) - \PP(D_2 = (x,y))\right| \\ &\leq \PP(x\in Y)\:
	\Big|\PP(D_1 
	= (x,y)| x\in Y) - \PP(D_2 = (x,y)|x\in Y)\Big| + \PP(x \not\in Y)  \\
	&\leq |\PP(D_1 = (x,y) | x \in Y) - \PP(D_2 = (x,y)|x \in Y)| + \sqrt{f(n)} \\
	&\leq 2\sqrt{f(n)} 
	\end{align*}
	
	Ainsi, il n'est pas possible qu'un automate $\mathcal{A}$
	polynomial probabiliste puisse distinguer 
	$\mathcal{D}_1$ de $\mathcal{D}_2$ car elle sont statistiquement 
	indistinguables.
	\end{proof}
	\begin{thm}
	Sous les hypothèses de la proposition précédente, le
	cryptosysteme est IND-CPA.
	\end{thm}
	\begin{proof}
	Comme un automate polynomial probabiliste ne peut pas distinguer
	$A_{s, \chi}$ de la distribution uniforme, on peut supposer que la
	clef publique $A$ est uniforme.

	Considérons alors un chiffré 
	\[C = \flatten\left(\mu \cdot \id_N + \bitdecomp(R\cdot A)\right) \in
	\ZZq^{N\times N}\]

	On a:
	\[ \bitdecomp^{-1}(C) = \mu * \bitdecomp(\id_N) + R\cdot A\]

	Par la proposition précédente, un automate polynomial probabiliste $\mathcal{A}$
	ne peut pas distinguer $R\cdot A$ d'une matrice uniforme. On peut donc
	supposer que $R\cdot A$ est uniforme, et que le chiffrement est donc
	un one-time pad.

	On en déduit qu'il n'existe pas d'automate polynomial probabiliste
	$\mathcal{A}$ permettant de déchiffrer efficacement les chiffrés de ce cryptosystème.
	\end{proof}
	
	\end{subsection}

	\begin{subsection}{Contraintes asymptotiques pour les choix de paramètres} 
		Le choix des paramètres du système est une étape cruciale de la mise en place de celui-ci,
	car ce sont eux qui détermineront les degrés de sécurités et la profondeur des circuits calculables.
	
	Sur ce point, deux approches sont possibles: une étude asymptotique ou
	bien une étude \og concrète \fg des paramètres.

	Nous nous interesserons ici uniquement à l'algorithme de déchiffrement
	\textbf{Dec}, nous ne considèrerons donc que des chiffrés de $0$ ou
	$1$ et nous interesserons principalement à la profondeur maximale 
	possible de NAND permettant encore de déchiffrer.

	\begin{subsubsection}{Analyse de la profondeur des circuits}
	Si $\chi$ est $B$-bornée, on voit en appliquant itérativement la
	minoration de bruit pour l'opération NAND que pour une profondeur de 
	$L$ NAND, le bruit est majoré en norme infinie par:
	\[{(N + 1)}^L B\]
	Or, afin de fonctinner, l'algorithme de dechiffrement
	\textbf{Dec} necessite que la norme infinie du bruit soit majorée par q/8.
	On obtient donc la condition suivante:
	\begin{equation}
		\label{depth}
		L \leq\frac{ \log(q) - 3 - \log(B)}{\log(N+1)}	\end{equation}
	\end{subsubsection}
	\begin{subsubsection}{Résumé des contraintes sur les paramètres}
	Nous indiquons ici quelques contraintes asymptotiques précisées
	dans la section 3.4 de \cite{EPRINT:GenSahWat13}. Nous n'avons 
	pas essayé de comprendre les raisons qui poussent à celles-ci
	car cela aurait necessité une étude bien plus poussée des différentes
	façon d'attaquer $LWE$.

	L'article conseille de faire croitere $n$ linéairement avec $\log(q/B)$, et,
	notant $\kappa = \log(q)$, d'avoir:
	\[ \kappa = O(L \log(N)) = O(L(\log(n) + \log(\kappa)) = O(L\log(n))\]

	\end{subsubsection}
	\end{subsection} % sécurité asymptotique

	\begin{subsection}{Choix concrets de paramètres}
	\begin{subsubsection}{Présentation de lwe\_estimator}
	
		Initialement utilisé dans l'article
		\cite{EPRINT:AlbPlaSco15},\path{lwe_estimator}
		(disponible à l'adresse \cite{estimator}) est un module de sagemath actuellement maintenu par
	Martin Albrecht et 
	destiné à estimer la résistance face à diverses attaques de paramètres précis pour
	le problème de learning with error.
	
	
	\paragraph{}
	\textbf{estimate\_lwe :}

	\paragraph{}
	Cependant, l'intérêt premier de ce module est qu'il estime la résistance des paramètres choisis à
	plusieurs attaques. Pour cela, on utilise la fonction \path{estimate_lwe} :
	
	\flushleft
	
	\begin{lstlisting}
estimate_lwe(n, alpha=None, q=None, secret_distribution=True, m=oo,
             reduction_cost_model=reduction_default_cost,
             skip=("mitm", "arora-gb", "bkw"))
        \end{lstlisting}
	
	\flushleft
	
	Cette dernière prends en arguments les paramètres usuels de LWE, n, $\alpha$ et q, ainsi que
	d'autres arguments optionnels et rend plusieurs résultats dont le sens n'est pas forcément évident.
	En fait, elle retourne tout un ensemble de variables pour chaque attaque vérifiée. Le module
	contient 6 attaques différentes, mais n'en testera que trois par defaut. Cela peut être modifié
	lorsque l'on appelle la fonction \path{estimate_lwe} via l'argument skip.
	
	\flushleft
	
	\begin{figure}
	\label{fig:seal_estimate}
	\begin{lstlisting}[mathescape=true]
sage: load("estimator.py")
sage: n = 2048; q = 2^60 - 2^14 + 1; $\alpha$ = 8/q; m = 2*n
sage: _ = estimate_lwe(n, $\alpha$, q, secret_distribution=(-1,1), 
	  reduction_cost_model=BKZ.sieve, m=m)
usvp: rop: =2^115.5,  red: =2^115.5,  $\delta_0$: 1.004975,  
      $\beta$:  288,  d: 4013,  m: 1964
 dec: rop: =2^127.1,  m:  =2^11.1,  red: =2^127.1,  $\delta_0$: 1.004663,  
      $\beta$: 318, d: 4237,  
      babai: =2^114.8,  babai_op: =2^129.9,  repeat: 7,  $\epsilon$: 0.500000
dual: rop: =2^118.4,  m:  =2^11.0,  red: =2^118.4,  $\delta_0$: 1.004864,  
      $\beta$: 298,  
      repeat:  =2^58.8,  d: 4090,  c:    3.909,  k: 30, postprocess: 13
	\end{lstlisting}
	\caption{Analyse de sécurité des paramètres tirés de la librairie SEAL}
	\end{figure}
	FIGURE 1 DEVRAIT ÊTRE ICI \\
	\flushleft
	
	Les variables rendues pour chaque attaques ne sont pas toutes utiles, certaines étant strictement internes à ces attaques. Les trois variables qui nous intéresse sont : "rop", "m" et "mem" :
	
	\begin{itemize}
	\item "rop" (ring operations) est une estimation du nombre d'opérations à effectuer afin de résoudre ce cas de LWE avec cette attaque.
	
	\item "mem" (memory) est une estimation de la mémoire qui sera exploitée.
	
	\item "m" indique le nombre d'échantillons nécessaires pour résoudre le problème avec ces valeurs de
	"rop" et "mem". A noter que l'on peut limiter le nombre d'échantillons disponibles pour l'attaquant
	lorsqu'on appelle \path{estimate_lwe}.
	\end{itemize}

	le module \path{sage.crypto.lwe} contient des choix de paramètres pour
	le problème LWE, dont deux qui utilisent la gaussienne discrète
	\footnote{un autre utilise la distribution uniforme}
	et que nous allons présenter ici. Notons que nous avons pour cela 
	regardé les codes 
	sources des fonctions sage, disponibles dans leur github (\cite{sage}).
	\end{subsubsection}

	\begin{subsubsection}{Proposition de choix sécurité pour très faible profondeur}
	\paragraph{}
	En utilisant les paramètres suivants, tirés de l'API SEAL:
	\[n = 2048\quad q = 2^{60} - 2^{14} + 1 \quad \alpha = \frac{8}{q}\quad m = 2n \]
	On voit que l'estimation proposée par lwe indique  l'attaque la plus rapide demande $2^{115}$ opérations de base dans l'anneau $\ZZq$, soit un facteur de sécurité de 115. De plus, l'équation~\eqref{depth} indique qu'une profondeur de NAND $L=3$ est possible. \\
	On a ici un secret de 15 Ko, une clé publique de 7.6 Mo et des chiffrés de 13 Go.

	\paragraph{}
	En utilisant les paramètres suivants, tirés de \cite{cryptoeprint:2015:755}:
	\[n = 804\quad  q = 2^{31} - 19\quad \alpha = \frac{\sqrt{2\pi}*57}{q} \quad m = 4972\]
	On voit que l'estimation proposée par lwe indique  l'attaque la plus rapide demande $2^{129}$ opérations de base dans l'anneau $\ZZq$, soit un facteur de sécurité de 129. De plus, l'équation~\eqref{depth} indique qu'une profondeur de NAND $L=1$ est possible. \\
	On a ici un secret de 3 Ko, une clé publique de 5 Mo et des chiffrés de 2 Go.
	\end{subsubsection}

	\end{subsection}
\end{section}
